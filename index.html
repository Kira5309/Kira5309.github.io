<body>
    <div id="loginContainer" class="login-container">
        <h2>ç™»å½•</h2>
        <input type="text" id="username" placeholder="è´¦å·">
        <input type="password" id="password" placeholder="å¯†ç ">
        <button onclick="handleLogin()">ç™»å½•</button>
        <p id="loginError" style="color: red; display: none;">è´¦å·æˆ–å¯†ç é”™è¯¯</p>
    </div>

    <div id="contentContainer" style="display: none;">
        <!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒ…æ¬²ä¹‹è·¯TikTok</title>
    
     <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: black; color: white; font-family: Arial, sans-serif; overflow: hidden; }
 .video-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: black;
    overflow: hidden; /* âœ… é˜²æ­¢è§†é¢‘è¶…å‡ºå±å¹• */
}

video {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    object-fit: contain; /* âœ… è®©è§†é¢‘å®Œæ•´æ˜¾ç¤ºï¼Œè€Œä¸ä¼šè¢«è£å‰ª */
}


        .bottom-bar { position: fixed; bottom: 0; width: 100%; display: flex; justify-content: space-around; padding: 10px 0; background: rgba(0, 0, 0, 0.5); }
        .bottom-bar button { background: none; border: none; color: white; font-size: 18px; cursor: pointer; }
        .menu { position: fixed; top: 10px; right: 10px; cursor: pointer; }
        .menu div { width: 30px; height: 4px; background: white; margin: 5px 0; }
        .nav { display: none; position: fixed; top: 0; right: 0; width: 200px; height: 100vh; background: rgba(0, 0, 0, 0.8); padding: 20px; }
        .nav a { display: block; color: white; text-decoration: none; margin: 10px 0; }
        .video-info { position: absolute; bottom: 70px; left: 10px; }
        .video-info p { margin: 5px 0; }
        
.nav {
    display: none;
    position: fixed;
    top: 0;
    right: 0;
    width: 200px;
    height: 100vh;
    background: rgba(0, 0, 0, 0.8);
    padding: 20px;
    transition: transform 0.3s ease-in-out;
}

.nav.active {
    display: block;
}



  #searchContainer {
    position: fixed;
    top: 35%; /* å‘ä¸Šè°ƒæ•´å¼¹å‡ºæœç´¢æ¡†ä½ç½® */
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.8);
    padding: 25px;
    border-radius: 15px;
    display: none;
  }

  /* å¢å¤§æœç´¢æŒ‰é’®å°ºå¯¸å¹¶æ·»åŠ æ¸å˜ */
  #searchButton {
    width: 60px;
    height: 30px;
    font-size: 15px;
    background: linear-gradient(45deg, #ff416c, #ff4b2b);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  #searchButton:hover {
    background: linear-gradient(45deg, #ff4b2b, #ff416c);
  }

 @media (max-width: 768px) {
    video {
        height: 100vh;
        width: auto; /* è®©è§†é¢‘åœ¨ç§»åŠ¨ç«¯ä¿æŒåŸæ¯”ä¾‹ */
    }
}

.hidden #progressBar {
    opacity: 0;
    visibility: hidden;
}

        
#progressBar {
    position: absolute;
    bottom: 100%; /* è®©è¿›åº¦æ¡ç´§è´´ `bottomBar` ä¸Šæ–¹ */
    left: 0;
    width: 100%;
    height: 5px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 5px;
    transition: opacity 0.5s ease-in-out;
}


#progressBar::-webkit-slider-thumb {
    width: 12px;
    height: 12px;
    background: red;
    border-radius: 50%;
    cursor: pointer;
    appearance: none;
}
        
#bottomBar, #menu, #progressBar {
    transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
    opacity: 1;
    visibility: visible;
}
        
.controls, .menu-icon, .progress-bar {
    transition: opacity 0.5s ease-in-out; /* å¹³æ»‘è¿‡æ¸¡ */
}

        
.hidden {
    display: none !important;
}

/* ğŸ“Œ å³ä¾§æ ‡ç­¾èœå• UI */
.tag-menu {
    position: fixed;
    top: 0;
    right: -35%; /* åˆå§‹éšè— */
    width: 30%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 20px;
    transition: right 0.3s ease;
    overflow-y: auto;
}

.tag-option {
    display: block;
    padding: 10px;
    margin: 5px 0;
    background: #333;
    cursor: pointer;
    text-align: center;
}

.tag-option:hover {
    background: #555;
}

/* é€‰ä¸­æ ‡ç­¾æ˜¾ç¤º */
#selectedTagDisplay {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 5px 10px;
    display: none;
}

/* ç™»å½• */
.login-container {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.9);
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    color: white;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.login-container input {
    width: 200px;
    padding: 10px;
    margin: 5px 0;
    border: none;
    border-radius: 5px;
}

.login-container button {
    padding: 10px;
    background: #ff4b2b;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}
#logoutBtn {
    position: fixed;
    top: 10px;
    left: 10px;  /* âœ… è°ƒæ•´åˆ°å·¦ä¸Šè§’ */
    padding: 8px 12px;
    background: red;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    z-index: 9999; /* âœ… ç¡®ä¿æŒ‰é’®å§‹ç»ˆåœ¨æœ€ä¸Šå±‚ */
}

#logoutBtn:hover {
    background: darkred;
}

/* ç™»å½•ç»“æŸ */
        
    </style>
</head>
<body>

<div class="video-container">
    <video id="video" autoplay loop muted playsinline></video>
</div>
<div id="selectedTagDisplay" style="position: absolute; top: 10px; left: 10px; background: rgba(0, 0, 0, 0.7); color: white; padding: 5px 10px; display: none;">
</div>


<div class="video-info">
    <p id="videoTitle">è§†é¢‘æ ‡é¢˜</p>
    <p id="videoTime">å‘å¸ƒæ—¶é—´</p>
    <p id="videoCategory">åˆ†ç±»</p>
</div>


<div id="searchContainer">
    <input type="text" id="searchInput" placeholder="æœç´¢ç”¨æˆ·åæˆ–æ ‡ç­¾">
    <button id="searchButton">æœç´¢</button>
</div>


   <script>
let videos = [];
let filteredVideos = []; // å­˜å‚¨æœç´¢ç»“æœ
let selectedTag = "å…¨éƒ¨"; // é»˜è®¤é€‰ä¸­â€œå…¨éƒ¨â€

async function loadVideos() {
    try {
        const response = await fetch("videos/videos.json"); // ç¡®ä¿è·¯å¾„æ­£ç¡®
        if (!response.ok) throw new Error("âŒ æœåŠ¡å™¨è¿”å›é”™è¯¯: " + response.status);
        
        videos = await response.json();
        filteredVideos = [...videos]; // âœ… é»˜è®¤åŠ è½½æ‰€æœ‰è§†é¢‘
        generateTagMenu();
        playRandomVideo(); // âœ… ç¡®ä¿æœ‰è§†é¢‘å¯æ’­æ”¾
    } catch (error) {
        console.error("âŒ åŠ è½½è§†é¢‘æ•°æ®å¤±è´¥:", error);
    }
}


// é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
document.addEventListener("DOMContentLoaded", loadVideos);


function playRandomVideo() {
    if (filteredVideos.length === 0) {
        console.warn("âš ï¸ æ²¡æœ‰åŒ¹é…çš„è§†é¢‘ï¼Œæ’­æ”¾æ‰€æœ‰è§†é¢‘ï¼");
        filteredVideos = [...videos]; // âœ… é˜²æ­¢ `filteredVideos` ä¸ºç©º
    }

    let randomIndex = Math.floor(Math.random() * filteredVideos.length);
    let data = filteredVideos[randomIndex];
    let videoElement = document.getElementById("video");
    let videoUrl = data.vod_play_url;

    console.log("ğŸ¥ æ­£åœ¨æ’­æ”¾è§†é¢‘ï¼š", videoUrl);

    if (videoElement.hlsInstance) {
        videoElement.hlsInstance.destroy();
        videoElement.hlsInstance = null;
    }

    if (videoUrl.endsWith(".m3u8")) {
        if (Hls.isSupported()) {
            let hls = new Hls();
            hls.loadSource(videoUrl);
            hls.attachMedia(videoElement);
            videoElement.hlsInstance = hls;

            hls.on(Hls.Events.MANIFEST_PARSED, function () {
                videoElement.currentTime = 20; // â© è‡ªåŠ¨è·³è¿‡å‰ 20 ç§’
                videoElement.play();
            });

        } else if (videoElement.canPlayType("application/vnd.apple.mpegurl")) {
            videoElement.src = videoUrl;
            videoElement.currentTime = 20; // â© è‡ªåŠ¨è·³è¿‡å‰ 20 ç§’
            videoElement.play();
        } else {
            console.error("âŒ ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒ M3U8 æ’­æ”¾ï¼");
            return;
        }
    } else {
        videoElement.src = videoUrl;
        videoElement.currentTime = 20; // â© è‡ªåŠ¨è·³è¿‡å‰ 20 ç§’
        videoElement.play();
    }

    document.getElementById("videoTitle").innerText = data.vod_name;
    document.getElementById("videoTime").innerText = data.vod_time;
    document.getElementById("videoCategory").innerText = data.type_name;
}






function searchVideos() {
    let query = document.getElementById("searchInput").value.trim().toLowerCase();
    if (query === "") {
        filteredVideos = [...videos]; // æ˜¾ç¤ºæ‰€æœ‰è§†é¢‘
    } else {
        filteredVideos = videos.filter(video =>
            video.username.toLowerCase().includes(query) ||
            video.tags.some(tag => tag.toLowerCase().includes(query))
        );
    }
    playRandomVideo(); // é‡æ–°æ’­æ”¾æœç´¢åçš„ç»“æœ
}

// ä¸»é¡µæŒ‰é’®ç‚¹å‡»äº‹ä»¶
function goHome() {
    window.location.href = "index.html"; // è¿”å›é¦–é¡µ
}

// å³ä¸Šè§’èœå•åˆ‡æ¢
function toggleMenu(event) {
    event.stopPropagation(); // âœ… é˜²æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…è¯¯å…³é—­èœå•
    let nav = document.getElementById("nav");
    let menu = document.getElementById("menu");

    // âœ… åˆ‡æ¢èœå•çŠ¶æ€
    nav.classList.toggle("active");

    // âœ… å¦‚æœèœå•æ˜¯å±•å¼€çš„ï¼Œæ·»åŠ ç›‘å¬å™¨
    if (nav.classList.contains("active")) {
        document.addEventListener("click", closeMenu);
    } else {
        document.removeEventListener("click", closeMenu);
    }
}

// âœ… ç‚¹å‡»å¤–éƒ¨åŒºåŸŸå…³é—­èœå•
function closeMenu(event) {
    let nav = document.getElementById("nav");
    let menu = document.getElementById("menu");

    if (!nav.contains(event.target) && !menu.contains(event.target)) {
        nav.classList.remove("active");
        document.removeEventListener("click", closeMenu);
    }
}





// PC ç«¯é¼ æ ‡æ»šè½®äº‹ä»¶
document.addEventListener("wheel", (event) => {
    if (event.deltaY > 10 || event.deltaY < -10) {
        playRandomVideo();
    }
});

// è§¦æ‘¸æ»‘åŠ¨äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ï¼‰
let touchStartY = 0;
document.addEventListener("touchstart", (evt) => {
    touchStartY = evt.touches[0].clientY;
}, false);

document.addEventListener("touchend", (evt) => {
    let touchEndY = evt.changedTouches[0].clientY;
    if (Math.abs(touchStartY - touchEndY) > 10) {
        playRandomVideo();
    }
}, false);

document.addEventListener("DOMContentLoaded", function () {
    loadVideos(); // âœ… åªè°ƒç”¨ä¸€æ¬¡ loadVideos()

    const progressBar = document.getElementById("progressBar");
    const video = document.getElementById("video");

    // ç›‘å¬è§†é¢‘æ’­æ”¾è¿›åº¦ï¼Œæ›´æ–°è¿›åº¦æ¡
    video.addEventListener("timeupdate", function () {
        let progress = (video.currentTime / video.duration) * 100;
        progressBar.value = progress;
    });

    // ç›‘å¬è¿›åº¦æ¡æ‹–åŠ¨ï¼Œè·³è½¬åˆ°å¯¹åº”æ—¶é—´
    progressBar.addEventListener("input", function () {
        let seekTime = (progressBar.value / 100) * video.duration;
        video.currentTime = seekTime;
    });

    // âœ… ä¿®æ­£æœç´¢æŒ‰é’®çš„é—®é¢˜
    const searchContainer = document.getElementById("searchContainer");
    const searchInput = document.getElementById("searchInput");
    const searchButton = document.getElementById("searchButton");
    const searchIcon = document.getElementById("searchIcon"); // âœ… è¿™é‡Œå®šä¹‰ï¼Œç¡®ä¿ HTML åŠ è½½å®Œæˆåè·å–

    if (!searchContainer || !searchInput || !searchButton || !searchIcon) {
        console.error("âŒ æœç´¢æ¡†æˆ–æŒ‰é’®æœªæ­£ç¡®åŠ è½½ï¼Œè¯·æ£€æŸ¥ HTML ç»“æ„");
        return;
    }

    // ç‚¹å‡»åº•éƒ¨ğŸ”æŒ‰é’®ï¼Œæ˜¾ç¤ºæœç´¢æ¡†
    searchIcon.addEventListener("click", function () {
        console.log("ğŸ” æŒ‰é’®è¢«ç‚¹å‡»ï¼Œå°è¯•æ˜¾ç¤ºæœç´¢æ¡†");
        searchContainer.style.display = "block";
        searchInput.focus();
    });

    // ç›‘å¬ Enter è§¦å‘æœç´¢
    searchInput.addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
            searchVideos();
            closeSearch();
        }
    });

    // ç‚¹å‡»æœç´¢æŒ‰é’®è§¦å‘æœç´¢
    searchButton.addEventListener("click", function () {
        searchVideos();
        closeSearch();
    });

    // å…³é—­æœç´¢æ¡†
    function closeSearch() {
        searchContainer.style.display = "none";
    }

    // ç‚¹å‡»æœç´¢æ¡†å¤–éƒ¨å…³é—­
    document.addEventListener("click", function (event) {
        if (!searchContainer.contains(event.target) && event.target !== searchIcon) {
            closeSearch();
        }
    });
});

// â¸ï¸ æ’­æ”¾ / æš‚åœ è§†é¢‘
function togglePlay() {
    let video = document.getElementById("video");
    if (video.paused) {
        video.play();
    } else {
        video.pause();
    }
}

// ğŸ”Š é™éŸ³ / å–æ¶ˆé™éŸ³
function toggleSound() {
    let video = document.getElementById("video");
    video.muted = !video.muted;
}

function toggleFullscreen() {
    let video = document.getElementById("video");

    if (!document.fullscreenElement) {
        if (video.requestFullscreen) {
            video.requestFullscreen();
        } else if (video.webkitRequestFullscreen) { // iOS Safari
            video.webkitRequestFullscreen();
        } else if (video.mozRequestFullScreen) { // Firefox
            video.mozRequestFullScreen();
        } else if (video.msRequestFullscreen) { // IE/Edge
            video.msRequestFullscreen();
        }

        // âœ… è®©è§†é¢‘åœ¨å…¨å±æ—¶ 100% é€‚é…å±å¹•
        video.style.width = "100%";
        video.style.height = "100%";
        video.style.objectFit = "contain";
    } else {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
        } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }

        // âœ… é€€å‡ºå…¨å±æ—¶æ¢å¤é»˜è®¤æ ·å¼
        video.style.width = "auto";
        video.style.height = "auto";
        video.style.objectFit = "contain";
    }
}



let uiElements = document.querySelectorAll("#bottomBar, #menu, #progressBar");
let isUIVisible = true; // è¿½è¸ª UI çŠ¶æ€

// æ˜¾ç¤º UI
let hideUITimer;
let lastInteractionTime = Date.now(); // è®°å½•ä¸Šæ¬¡äº¤äº’æ—¶é—´

function hideUI() {
    console.log("â³ UI æ­£åœ¨éšè—...");
    document.getElementById("bottomBar").classList.add("hidden");
    document.getElementById("menu").classList.add("hidden");
    document.getElementById("progressBar").classList.add("hidden");
}

function showUI() {
    console.log("ğŸ‘€ UI é‡æ–°æ˜¾ç¤º...");
    document.getElementById("bottomBar").classList.remove("hidden");
    document.getElementById("menu").classList.remove("hidden");
    document.getElementById("progressBar").classList.remove("hidden");
    lastInteractionTime = Date.now(); // æ›´æ–°äº¤äº’æ—¶é—´
}


function checkAutoHide() {
    if (Date.now() - lastInteractionTime > 3000) { // 3 ç§’æ— æ“ä½œ
        hideUI();
    }
    requestAnimationFrame(checkAutoHide); // æŒç»­æ£€æŸ¥
}

// ç›‘å¬ç”¨æˆ·äº¤äº’äº‹ä»¶
["mousemove", "touchstart", "click"].forEach(event => {
    document.addEventListener(event, function () {
        console.log("ğŸ‘† ç”¨æˆ·äº¤äº’ï¼Œé‡ç½®éšè—è®¡æ—¶å™¨");
        showUI();
    });
});

// é¡µé¢åŠ è½½åå¯åŠ¨ UI ç›‘æµ‹
document.addEventListener("DOMContentLoaded", function () {
    console.log("âœ… é¡µé¢å·²åŠ è½½ï¼Œå¼€å§‹ç›‘å¬ UI è‡ªåŠ¨éšè—");
    showUI();
    requestAnimationFrame(checkAutoHide); // å¯åŠ¨éšè—æ£€æµ‹
});


document.addEventListener("DOMContentLoaded", function () {
    const video = document.getElementById("video");

    // âœ… ç‚¹å‡»å±å¹•æ’­æ”¾ / æš‚åœ
    video.addEventListener("click", function () {
        if (video.paused) {
            video.play();
        } else {
            video.pause();
        }
    });

    console.log("ğŸ¥ å·²å¯ç”¨ç‚¹å‡»æ’­æ”¾/æš‚åœåŠŸèƒ½");
});

function toggleTagMenu(event) {
    if (event) {
        event.stopPropagation(); // é˜²æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…è¯¯å…³é—­èœå•
    }

    let menu = document.getElementById("tagMenu");
    if (!menu) {
        console.error("âŒ tagMenu æœªæ‰¾åˆ°ï¼Œè¯·æ£€æŸ¥ HTML ç»“æ„ï¼");
        return;
    }

    // åˆ‡æ¢èœå•çŠ¶æ€
    if (menu.style.right === "0px") {
        menu.style.right = "-35%";
        document.removeEventListener("click", closeTagMenu); // å–æ¶ˆç›‘å¬å…³é—­äº‹ä»¶
    } else {
        menu.style.right = "0px";
        document.addEventListener("click", closeTagMenu); // ç›‘å¬ç‚¹å‡»å¤–éƒ¨å…³é—­èœå•
    }
}

// ğŸ“Œ ç›‘å¬ç‚¹å‡»ç©ºç™½å¤„å…³é—­æ ‡ç­¾èœå•
function closeTagMenu(event) {
    let menu = document.getElementById("tagMenu");
    if (!menu.contains(event.target)) { // å¦‚æœç‚¹å‡»çš„ä¸æ˜¯èœå•æœ¬èº«
        menu.style.right = "-35%";
        document.removeEventListener("click", closeTagMenu);
    }
}





// ğŸ“Œ åŠ è½½æ ‡ç­¾åˆ—è¡¨
function loadTags() {
    let tagSet = new Set();
    videos.forEach(video => video.tags.forEach(tag => tagSet.add(tag)));

    let tagList = document.getElementById("tagList");
    tagList.innerHTML = ""; // æ¸…ç©ºæ—§æ•°æ®

    tagSet.forEach(tag => {
        let div = document.createElement("div");
        div.className = "tag-option";
        div.innerText = tag;
        div.onclick = () => filterVideos(tag);
        tagList.appendChild(div);
    });
}

function selectTag(tag) {
    document.getElementById("selectedTag").innerText = tag; // âœ… æ›´æ–° UI æ˜¾ç¤ºå½“å‰é€‰ä¸­çš„æ ‡ç­¾
    filterVideos(tag); // ä¼ å…¥é€‰ä¸­çš„æ ‡ç­¾

    // ğŸ“Œ é€‰æ‹©æ ‡ç­¾åï¼Œè‡ªåŠ¨æ”¶èµ·èœå•
    let menu = document.getElementById("tagMenu");
    menu.style.right = "-35%";
    document.removeEventListener("click", closeTagMenu);
}


function filterVideos(selectedTag) {
    let searchQuery = document.getElementById("searchInput").value.trim().toLowerCase();

    filteredVideos = videos.filter(video => {
        let titleMatch = video.vod_name.toLowerCase().includes(searchQuery);
        let tagMatch = selectedTag === "å…¨éƒ¨" || video.type_name.includes(selectedTag);
        return titleMatch && tagMatch;
    });

    if (filteredVideos.length === 0) {
        console.warn("âš ï¸ æœªæ‰¾åˆ°åŒ¹é…çš„è§†é¢‘ï¼Œæ’­æ”¾æ‰€æœ‰è§†é¢‘");
        filteredVideos = [...videos]; // âœ… é˜²æ­¢ `filteredVideos` ä¸ºç©º
    }

    playRandomVideo();
}




function generateTagMenu() {
    let tagMenu = document.getElementById("tag-menu-list");
    if (!tagMenu) {
        console.error("âŒ tag-menu-list æœªæ‰¾åˆ°ï¼Œè¯·æ£€æŸ¥ HTML ç»“æ„ï¼");
        return;
    }

    tagMenu.innerHTML = ""; // æ¸…ç©ºæ—§æ ‡ç­¾
    let uniqueTags = Array.from(new Set(videos.map(video => video.type_name))); // âœ… è¯†åˆ« type_name å¹¶å»é‡

    uniqueTags.unshift("å…¨éƒ¨"); // æ·»åŠ â€œå…¨éƒ¨â€é€‰é¡¹

    uniqueTags.forEach(tag => {
        let tagElement = document.createElement("div");
        tagElement.classList.add("tag-item");
        tagElement.innerText = tag;
        tagElement.onclick = () => selectTag(tag); // ç»‘å®šç‚¹å‡»äº‹ä»¶
        tagMenu.appendChild(tagElement);
    });
}

// ç¡®ä¿ generateTagMenu åœ¨åŠ è½½è§†é¢‘æ•°æ®åè°ƒç”¨
document.addEventListener("DOMContentLoaded", () => {
    fetch("videos/videos.json")
        .then(response => response.json())
        .then(data => {
            videos = data;  // âœ… ç¡®ä¿ `videos` æ•°æ®åŠ è½½
            generateTagMenu();
        })
        .catch(error => console.error("âŒ åŠ è½½ videos.json å¤±è´¥", error));
});






document.addEventListener("DOMContentLoaded", loadTags);


const ads = [
    { image: "https://pic.qqans.com/up/2019-3/2019030515394962246.png", link: "https://slightlyrudge.github.io/" },
    { image: "https://pic.qqans.com/up/2019-3/2019030515394962246.png", link: "https://slightlyrudge.github.io/" },
    { image: "https://pic.qqans.com/up/2019-3/2019030515394962246.png", link: "https://slightlyrudge.github.io/" },
    { image: "https://pic.qqans.com/up/2019-3/2019030515394962246.png", link: "https://slightlyrudge.github.io/" },
    { image: "https://pic.qqans.com/up/2019-3/2019030515394962246.png", link: "https://slightlyrudge.github.io/" }
];

let slideCount = 0;

function onVideoSwipe() {
    slideCount++;

    if (slideCount >= Math.floor(Math.random() * 2) + 5) { // 3-4æ¬¡æ»‘åŠ¨åè§¦å‘å¹¿å‘Š2+3ã€‚4-5æ¬¡ä¿®æ”¹2+4ã€‚5-6æ¬¡ä¿®æ”¹2+5ã€‚ä»¥æ­¤ç±»æ¨
        showFloatingAd();
        slideCount = 0; // é‡ç½®è®¡æ•°å™¨
    }
}

function showFloatingAd() {
    let ad = ads[Math.floor(Math.random() * ads.length)];
    
    document.getElementById("adImage").src = ad.image;
    document.getElementById("adLink").href = ad.link;
    document.getElementById("floatingAd").style.display = "block";

    setTimeout(closeAd, 10000); // 10 ç§’åè‡ªåŠ¨å…³é—­
}

function closeAd() {
    document.getElementById("floatingAd").style.display = "none";
}

// ç›‘å¬æ»‘åŠ¨äº‹ä»¶
document.addEventListener("wheel", onVideoSwipe); // PC ç«¯é¼ æ ‡æ»šè½®
document.addEventListener("touchend", onVideoSwipe); // æ‰‹æœºç«¯æ»‘åŠ¨


function playVideo(video) {
    const videoElement = document.getElementById("video-player");
    videoElement.src = video.vod_play_url;
    document.getElementById("video-title").textContent = video.vod_name;
    document.getElementById("video-time").textContent = video.vod_time;
    document.getElementById("video-category").textContent = video.type_name;
}



async function handleLogin() {
    let username = document.getElementById("username").value.trim();
    let password = document.getElementById("password").value.trim();

    try {
        let response = await fetch("fl/users.json"); // âœ… ç¡®ä¿è·¯å¾„æ­£ç¡®
        if (!response.ok) {
            throw new Error("âŒ æ— æ³•è®¿é—®ç”¨æˆ·æ•°æ®");
        }

        let users = await response.json();
        let user = users.find(u => u.username === username && u.password === password);

        if (user) {
            console.log("âœ… ç™»å½•æˆåŠŸï¼");
            localStorage.setItem("isLoggedIn", "true"); // âœ… è®°ä½ç™»å½•çŠ¶æ€
            document.getElementById("loginContainer").style.display = "none"; // âœ… éšè—ç™»å½•ç•Œé¢
            document.getElementById("contentContainer").style.display = "block"; // âœ… ç°åœ¨å¯ä»¥çœ‹å†…å®¹
            document.body.style.overflow = "auto";
        } else {
            console.log("âŒ è´¦å·æˆ–å¯†ç é”™è¯¯");
            document.getElementById("loginError").innerText = "âŒ è´¦å·æˆ–å¯†ç é”™è¯¯ï¼";
            document.getElementById("loginError").style.display = "block"; // âœ… æ˜¾ç¤ºé”™è¯¯æç¤º
        }
    } catch (error) {
        console.error("âŒ æ— æ³•åŠ è½½ç”¨æˆ·æ•°æ®ï¼š", error);
        document.getElementById("loginError").innerText = "âš ï¸ æœåŠ¡å™¨é”™è¯¯ï¼Œæ— æ³•éªŒè¯è´¦å·ï¼";
        document.getElementById("loginError").style.display = "block";
    }
}





document.addEventListener("DOMContentLoaded", async () => {
    console.log("ğŸ“Œ é¡µé¢å·²åŠ è½½ï¼Œæ£€æŸ¥ç™»å½•çŠ¶æ€...");

    // âœ… å¦‚æœ localStorage é‡Œå­˜äº† "true"ï¼Œæ˜¾ç¤ºç½‘ç«™å†…å®¹
    if (localStorage.getItem("isLoggedIn") === "true") {
        console.log("ğŸ”“ å·²ç™»å½•ï¼Œæ˜¾ç¤ºç½‘ç«™å†…å®¹");
        document.getElementById("loginContainer").style.display = "none";
        document.getElementById("contentContainer").style.display = "block"; // âœ… ç°åœ¨å¯ä»¥çœ‹å†…å®¹
        document.body.style.overflow = "auto";
        return;
    }

    // â—â— å¼ºåˆ¶è®©æœªç™»å½•ç”¨æˆ·ç•™åœ¨ç™»å½•ç•Œé¢
    document.getElementById("loginContainer").style.display = "flex";
    document.getElementById("contentContainer").style.display = "none"; // âŒ ç½‘ç«™å†…å®¹ä¸æ˜¾ç¤º
    document.body.style.overflow = "hidden"; // âœ… ç¦æ­¢æ»šåŠ¨ï¼Œé˜²æ­¢ç»•è¿‡ç™»å½•
});

function logout() {
    localStorage.removeItem("isLoggedIn"); // âœ… æ¸…é™¤ç™»å½•çŠ¶æ€
    location.reload(); // âœ… åˆ·æ–°é¡µé¢ï¼Œè¿”å›ç™»å½•ç•Œé¢
}


</script>

<div id="bottomBar" class="bottom-bar">
    <input type="range" id="progressBar" value="0" min="0" max="100" step="0.1">
    <button onclick="goHome()">ğŸ </button>
    <button id="searchIcon">ğŸ”</button>
    <button onclick="togglePlay()">â¸ï¸</button>
    <button onclick="toggleSound()">ğŸ”Š</button>
    <button onclick="toggleFullscreen()">â›¶</button>
</div>


<div id="menu" class="menu" onclick="toggleMenu(event)">
    <div></div>
    <div></div>
    <div></div>
</div>

    <div class="nav" id="nav">
        <a href="index.html">é¦–é¡µ</a>
        <a href="javascript:void(0);" onclick="toggleTagMenu(event)">æ ‡ç­¾</a>
        <a href="contact.html">è”ç³»æˆ‘ä»¬</a>
        <a href="gghz.html">å¹¿å‘Šåˆä½œ</a>
        <a href="cjwt.html">å¸¸é—®é—®é¢˜</a>
        <a href="DMCA.html">DMCA</a>
        <a href="mzsm.html">å…è´£å£°æ˜</a>
        <a href="yszc.html">éšç§æ”¿ç­–</a>
        <a href="fuwutiaokuan.html">æœåŠ¡æ¡æ¬¾</a>
    </div>


<!-- ğŸ“Œ å³ä¾§æ ‡ç­¾é€‰æ‹© UI -->
<div id="tagMenu" class="tag-menu">
    <h3>é€‰æ‹©æ ‡ç­¾</h3>
    <p>å½“å‰é€‰ä¸­ï¼š<span id="selectedTag">å…¨éƒ¨</span></p> <!-- âœ… æ˜¾ç¤ºå½“å‰é€‰ä¸­çš„æ ‡ç­¾ -->
    <div id="tag-menu-list"></div> <!-- âœ… ç¡®ä¿ ID åŒ¹é… -->
</div>

 <button id="logoutBtn" onclick="logout()">é€€å‡ºç™»å½•</button>


<!-- ğŸ“Œ åº•éƒ¨æµ®åŠ¨å¹¿å‘Š -->
<div id="floatingAd" style="
    display: none;
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    padding: 10px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    text-align: center;
    z-index: 1000;
">
    <a id="adLink" href="#" target="_blank">
        <img id="adImage" src="" alt="å¹¿å‘Š" style="width: 300px; height: auto;">
    </a>
    <button onclick="closeAd()" style="
        display: block;
        margin: 5px auto 0;
        background: red;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
    ">å…³é—­</button>
</div>
</html>
    </div>
</body>
